<Window x:Class="MLNetAnomalyDetection.Views.Dashboard"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
        Title="ML.NET Network Anomaly Dashboard" Height="450" Width="800"
        Background="#1E1E1E" Foreground="White"
        WindowStartupLocation="CenterScreen"
        Closing="Window_Closing">
    <Window.Resources>
        <Style TargetType="ComboBoxItem">
            <Setter Property="Foreground" Value="White" />
            <Setter Property="Background" Value="#2D2D2D" />
            <Setter Property="Padding" Value="5,2" />
            <Style.Resources>
                <!-- This overrides the default blue highlight in dark mode -->
                <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="#FF007ACC"/>
                <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="White"/>
            </Style.Resources>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#007ACC" />
                    <Setter Property="FontWeight" Value="Bold" />
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0">
            <TextBlock Text="{Binding StatusText}" 
                       FontSize="16" FontWeight="Bold" 
                       HorizontalAlignment="Center" Margin="0,0,0,5"/>
            
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,10">
                <TextBlock Text="Monitor Adapter:" VerticalAlignment="Center" Margin="0,0,10,0" Foreground="LightGray"/>
                <ComboBox ItemsSource="{Binding Adapters}" 
                          SelectedItem="{Binding SelectedAdapter}"
                          Width="550" 
                          Background="#333" Foreground="White"
                          BorderBrush="Gray">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="{Binding FriendlyName}" FontWeight="Bold" />
                                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="5,0,0,0">
                                    <TextBlock Text="(" Foreground="LightGray" />
                                    <TextBlock Text="{Binding IpAddress}" Foreground="DodgerBlue" />
                                    <TextBlock Text=")" Foreground="LightGray" />
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
            </StackPanel>
        </StackPanel>

        <!-- Stable LiveCharts.Wpf CartesianChart -->
        <lvc:CartesianChart Grid.Row="1" DisableAnimations="True" Hoverable="False" DataTooltip="{x:Null}" LegendLocation="Top">
            <lvc:CartesianChart.ChartLegend>
                <lvc:DefaultLegend Foreground="White" />
            </lvc:CartesianChart.ChartLegend>
            <lvc:CartesianChart.Series>
                <lvc:LineSeries Title="Traffic (KB/s)" Values="{Binding TrafficValues}" 
                                PointGeometry="{x:Null}" LineSmoothness="0.5" StrokeThickness="2" 
                                Stroke="DodgerBlue" Fill="#331E90FF" ScalesYAt="0" />
                <lvc:LineSeries Title="Anomaly Score" Values="{Binding AnomalyScores}" 
                                PointGeometry="{x:Null}" LineSmoothness="0.5" StrokeThickness="2" 
                                Stroke="OrangeRed" Fill="Transparent" ScalesYAt="1" />
            </lvc:CartesianChart.Series>
            <lvc:CartesianChart.AxisX>
                <lvc:Axis ShowLabels="False" />
            </lvc:CartesianChart.AxisX>
            <lvc:CartesianChart.AxisY>
                <lvc:Axis Title="Traffic (KB/s)" MinValue="0" Foreground="DodgerBlue" LabelFormatter="{Binding TrafficFormatter}"/>
                <lvc:Axis Title="Score" Position="RightTop" MinValue="0" Foreground="OrangeRed" LabelFormatter="{Binding ScoreFormatter}"/>
            </lvc:CartesianChart.AxisY>
        </lvc:CartesianChart>

        <!-- Detailed Metrics Section -->
        <Border Grid.Row="2" Background="#2D2D2D" CornerRadius="5" Padding="10" Margin="0,10,0,0">
            <UniformGrid Columns="5">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="Packets/s" Foreground="Gray" FontSize="10" HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding PacketsPerSecond}" Foreground="White" FontSize="18" FontWeight="Bold" HorizontalAlignment="Center"/>
                </StackPanel>
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="Unique IPs" Foreground="Gray" FontSize="10" HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding UniqueIps}" Foreground="White" FontSize="18" FontWeight="Bold" HorizontalAlignment="Center"/>
                </StackPanel>
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="Unusual Port Traffic" Foreground="Gray" FontSize="10" HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding UnusualPortTraffic, StringFormat={}{0} bytes}" Foreground="White" FontSize="14" FontWeight="Bold" HorizontalAlignment="Center"/>
                </StackPanel>
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="Outbound Ratio" Foreground="Gray" FontSize="10" HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding OutboundRatio, StringFormat={}{0:F2}}" Foreground="White" FontSize="18" FontWeight="Bold" HorizontalAlignment="Center"/>
                </StackPanel>
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="Baseline Score" Foreground="Gray" FontSize="10" HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding AnomalyScores.LastOrDefault, StringFormat={}{0:F2}}" Foreground="OrangeRed" FontSize="18" FontWeight="Bold" HorizontalAlignment="Center"/>
                </StackPanel>
            </UniformGrid>
        </Border>
    </Grid>
</Window>
